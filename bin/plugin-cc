#!/bin/sh
bin=`dirname $0`

# Grab positional arguments necessary information for loading a plugin.
plugincc=$1
pluginbase=`dirname $plugincc`
compiler=`basename $plugincc`
pluginlib=$2
pluginname=$3
shift 3

# Choose cc or c++ based on the executable name.
if [ "${compiler#*++}" != "$compiler" ]; then
    cc=c++
else
    cc=cc
fi

# Construct Clang arguments.
if [ `uname` = "Darwin" ]; then
    libext=dylib
else
    libext=so
fi
args="-Xclang -load -Xclang $pluginbase/$pluginlib.$libext \
    -Xclang -add-plugin -Xclang $pluginname"

exec $bin/$cc $args $@
